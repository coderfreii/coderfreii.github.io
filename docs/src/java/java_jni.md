# JNI

## 前置知识

~~~java
javac Hello.java 
~~~



~~~shell
cl  -I 指定 lib
~~~



# win

#  编写native方法

~~~java
package com.tcoder.trial;

public class Hello {
    static {
       //加载其他语言的动态连接库    此处win平台为  Hello.dll
       System.loadLibrary("Hello");
       /*when classload load the class input jvm,it will load the methods of Hello.dll into native method of jvm;
           this way suppport the input with absolute path.such as xx/xx/Hello.dll;
       */
    }
    //这是native 方法的定义
    public native void h();
    
    public static void main(String[] args) {
        new Hello().h();
    }
}
~~~

# 编译java 文件

~~~java
javac Hello.java 
~~~

# 生成C头文件

~~~java
javah  com.tcoder.trial.Hello  
~~~



~~~c
/* DO NOT EDIT THIS FILE - it is machine generated */
#include "jni.h"
/* Header for class com_tcoder_trial_Hello */

#ifndef _Included_com_tcoder_trial_Hello
#define _Included_com_tcoder_trial_Hello
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     com_tcoder_trial_Hello
 * Method:    h
 * Signature: ()V
 */
JNIEXPORT void JNICALL Java_com_tcoder_trial_Hello_h
  (JNIEnv *, jobject);

#ifdef __cplusplus
}
#endif
#endif

~~~



# 编写  c 语言具体实现

~~~c
#include "jni.h"
#include "com_tcoder_trial_Hello.h"
#include <String.h>

JNIEXPORT void JNICALL Java_com_tcoder_trial_Hello_h(JNIEnv * env, jobject obj) {
    printf("Hello! ");
    return;
}
~~~

# 生成动态链接库(将本地代码编译成动态库)

关于动态库的说明：
即将上面的Hello.c变成Hello.dll等动态库文件；
windows对应动态库为*.dll ，linux/unix对应动态库为 *.so ，mac os x对应动态库为 *.jnilib 
下面以windows环境来说明如何实现xx.c-->xx.dll文件的转变
操作：
cl -I %JAVA_HOME%\include -I %JAVA_HOME%\include\win32 -LD Hello.c -FeHello.dll
备注：
在cmd中输入是没有该命令的，推荐进入《VS2012 X64工具命令提示》输入cl是有该命令的；
-I指定包含编译的头文件，所在的目录
-LD 指定被编译动态库的目标文件
-Fe 指定生成的动态链接库的文件名；千万注意Fe和后面的名字不能有空格！！！
结果：
得到文件Hello,dll

## CL方式

环境设置

+  cl 命令   需要安装vss c++环境



#inclued  需要的库   设置环境变量  `INCLUDE`

~~~java
C:\Program Files (x86)\Windows Kits\10\Include\10.0.19041.0\shared
C:\Program Files (x86)\Windows Kits\10\Include\10.0.19041.0\ucrt
C:\Program Files (x86)\Windows Kits\10\Include\10.0.19041.0\um
C:\Program Files (x86)\Windows Kits\10\Include\10.0.19041.0\winrt
%JAVA_HOME%\include
D:\software\jdk8\include\win32
~~~



cl 需要的库     设置环境变量  `LIB`

~~~shell
C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Tools\MSVC\14.29.30133\lib\x64

C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Tools\MSVC\14.29.30133\lib\x64
C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Tools\MSVC\14.29.30133\lib\x64
~~~



~~~shell
cl -LD Hello.c -FeHello
~~~



# 运行

## java命令行运行

### 动态指定javalibrary路径

~~~shell
java “-Djava.library.path= Hello.dll所在路径 ” com.tcoder.trial.Hello  
~~~

### 设置环境变量

~~~java
System.out.println(System.getProperty("java.library.path"));  //可证明路径为环境变量path

将Hello.dll 放入环境变量路径即可
~~~

