#### openfein

本文主要是探讨为何开启ouath2 是 配置文件不能提供服务名而是要提供具体的ip地址

该问题是在研究一个开源项目piggymetrics是遇到的

debug后的发现原因是 oauth2使用的restTemplate 没有实现负载均衡故而无法拉取授权服务器的真实地址

解决方法 重写 oauth2FeignRequestInterceptor 提供一个@LoadBalanced 的restTemplate 实例即可

~~~java
    @Bean
    public RequestInterceptor oauth2FeignRequestInterceptor() {
        OAuth2FeignRequestInterceptor oAuth2FeignRequestInterceptor = new OAuth2FeignRequestInterceptor(new DefaultOAuth2ClientContext(), clientCredentialsResourceDetails());
        AccessTokenProviderChain accessTokenProviderChain = new AccessTokenProviderChain(Arrays.asList(new AuthorizationCodeAccessTokenProvider(), loadBalancedClientCredentialsAccessTokenProvider()));
        oAuth2FeignRequestInterceptor.setAccessTokenProvider(accessTokenProviderChain);
        return oAuth2FeignRequestInterceptor;
    }


    @Bean
    @LoadBalanced
    RestTemplate restTemplate() {
        RestTemplate restTemplate = new RestTemplate();
        return restTemplate;
    }



    public class LoadBalancedClientCredentialsAccessTokenProvider extends ClientCredentialsAccessTokenProvider {

        private RestOperations restTemplate;
        private List<HttpMessageConverter<?>> messageConverters;

        private ClientHttpRequestFactory requestFactory = new SimpleClientHttpRequestFactory() {
            @Override
            protected void prepareConnection(HttpURLConnection connection, String httpMethod)
                    throws IOException {
                super.prepareConnection(connection, httpMethod);
                connection.setInstanceFollowRedirects(false);
                connection.setUseCaches(false);
            }
        };

        @Override
        protected RestOperations getRestTemplate() {
            if (this.restTemplate == null) {
                synchronized (this) {
                    if (restTemplate == null) {
                        RestTemplate restTemplate = restTemplate();
                        restTemplate.setErrorHandler(getResponseErrorHandler());
                        restTemplate.setRequestFactory(requestFactory);
                        this.restTemplate = restTemplate;
                    }
                }
            }
            if (messageConverters == null) {
                setMessageConverters(new RestTemplate().getMessageConverters());
            }
            return restTemplate;
        }

        public void setMessageConverters(List<HttpMessageConverter<?>> messageConverters) {
            this.messageConverters = new ArrayList<HttpMessageConverter<?>>(messageConverters);
            this.messageConverters.add(new FormOAuth2AccessTokenMessageConverter());
            this.messageConverters.add(new FormOAuth2ExceptionHttpMessageConverter());
        }

        protected ResponseExtractor<OAuth2AccessToken> getResponseExtractor() {
            getRestTemplate(); // force initialization
            return new HttpMessageConverterExtractor<OAuth2AccessToken>(OAuth2AccessToken.class, this.messageConverters);
        }
    };

    /**
     * 负载均衡客户端凭据访问令牌提供者
     *
     * @return {@link ClientCredentialsAccessTokenProvider}
     */
    @Bean
    ClientCredentialsAccessTokenProvider loadBalancedClientCredentialsAccessTokenProvider() {
        LoadBalancedClientCredentialsAccessTokenProvider loadBalancedClientCredentialsAccessTokenProvider = new LoadBalancedClientCredentialsAccessTokenProvider();
        return loadBalancedClientCredentialsAccessTokenProvider;
    }
~~~



-----------------

以下为修改后openfein的源码调用逻辑



###### 初始化默认LoadBalancer(Request request = targetRequest(template)分支)

~~~java
getUpdatedListOfServers:56, DomainExtractingServerList (org.springframework.cloud.netflix.ribbon.eureka)
//获取服务列表
updateListOfServers:240, DynamicServerListLoadBalancer (com.netflix.loadbalancer)
restOfInit:144, DynamicServerListLoadBalancer (com.netflix.loadbalancer)
<init>:95, DynamicServerListLoadBalancer (com.netflix.loadbalancer)
<init>:82, ZoneAwareLoadBalancer (com.netflix.loadbalancer)
//初始化默认LoadBalancer
ribbonLoadBalancer:137, RibbonClientConfiguration (org.springframework.cloud.netflix.ribbon)
CGLIB$ribbonLoadBalancer$0:-1, RibbonClientConfiguration$$EnhancerBySpringCGLIB$$d4ec3384 (org.springframework.cloud.netflix.ribbon)
invoke:-1, RibbonClientConfiguration$$EnhancerBySpringCGLIB$$d4ec3384$$FastClassBySpringCGLIB$$1050abea (org.springframework.cloud.netflix.ribbon)
invokeSuper:228, MethodProxy (org.springframework.cglib.proxy)
intercept:361, ConfigurationClassEnhancer$BeanMethodInterceptor (org.springframework.context.annotation)
ribbonLoadBalancer:-1, RibbonClientConfiguration$$EnhancerBySpringCGLIB$$d4ec3384 (org.springframework.cloud.netflix.ribbon)
invoke0:-1, NativeMethodAccessorImpl (sun.reflect)
invoke:62, NativeMethodAccessorImpl (sun.reflect)
invoke:43, DelegatingMethodAccessorImpl (sun.reflect)
invoke:498, Method (java.lang.reflect)
instantiate:154, SimpleInstantiationStrategy (org.springframework.beans.factory.support)
instantiateUsingFactoryMethod:582, ConstructorResolver (org.springframework.beans.factory.support)
instantiateUsingFactoryMethod:1256, AbstractAutowireCapableBeanFactory (org.springframework.beans.factory.support)
createBeanInstance:1105, AbstractAutowireCapableBeanFactory (org.springframework.beans.factory.support)
doCreateBean:543, AbstractAutowireCapableBeanFactory (org.springframework.beans.factory.support)
createBean:503, AbstractAutowireCapableBeanFactory (org.springframework.beans.factory.support)
lambda$doGetBean$0:317, AbstractBeanFactory (org.springframework.beans.factory.support)
getObject:-1, 34073107 (org.springframework.beans.factory.support.AbstractBeanFactory$$Lambda$167)
getSingleton:222, DefaultSingletonBeanRegistry (org.springframework.beans.factory.support)
doGetBean:315, AbstractBeanFactory (org.springframework.beans.factory.support)
getBean:199, AbstractBeanFactory (org.springframework.beans.factory.support)
resolveCandidate:251, DependencyDescriptor (org.springframework.beans.factory.config)
doResolveDependency:1138, DefaultListableBeanFactory (org.springframework.beans.factory.support)
resolveDependency:1065, DefaultListableBeanFactory (org.springframework.beans.factory.support)
resolveAutowiredArgument:818, ConstructorResolver (org.springframework.beans.factory.support)
createArgumentArray:724, ConstructorResolver (org.springframework.beans.factory.support)
instantiateUsingFactoryMethod:474, ConstructorResolver (org.springframework.beans.factory.support)
instantiateUsingFactoryMethod:1256, AbstractAutowireCapableBeanFactory (org.springframework.beans.factory.support)
createBeanInstance:1105, AbstractAutowireCapableBeanFactory (org.springframework.beans.factory.support)
doCreateBean:543, AbstractAutowireCapableBeanFactory (org.springframework.beans.factory.support)
createBean:503, AbstractAutowireCapableBeanFactory (org.springframework.beans.factory.support)
lambda$doGetBean$0:317, AbstractBeanFactory (org.springframework.beans.factory.support)
getObject:-1, 34073107 (org.springframework.beans.factory.support.AbstractBeanFactory$$Lambda$167)
getSingleton:222, DefaultSingletonBeanRegistry (org.springframework.beans.factory.support)
doGetBean:315, AbstractBeanFactory (org.springframework.beans.factory.support)
getBean:199, AbstractBeanFactory (org.springframework.beans.factory.support)
preInstantiateSingletons:760, DefaultListableBeanFactory (org.springframework.beans.factory.support)
finishBeanFactoryInitialization:869, AbstractApplicationContext (org.springframework.context.support)
refresh:550, AbstractApplicationContext (org.springframework.context.support)
createContext:117, NamedContextFactory (org.springframework.cloud.context.named)
getContext:85, NamedContextFactory (org.springframework.cloud.context.named)
getContext:118, SpringClientFactory (org.springframework.cloud.netflix.ribbon)
getInstance:126, NamedContextFactory (org.springframework.cloud.context.named)
getInstance:108, SpringClientFactory (org.springframework.cloud.netflix.ribbon)
//根据服务名创建 子spring环境
getLoadBalancerContext:73, SpringClientFactory (org.springframework.cloud.netflix.ribbon)
createRetryPolicy:38, RibbonLoadBalancedRetryFactory (org.springframework.cloud.netflix.ribbon)
//此拦截器中
intercept:64, RetryLoadBalancerInterceptor (org.springframework.cloud.client.loadbalancer)
execute:92, InterceptingClientHttpRequest$InterceptingRequestExecution (org.springframework.http.client)
intercept:53, TracingClientHttpRequestInterceptor (brave.spring.web)
intercept:292, LazyTracingClientHttpRequestInterceptor (org.springframework.cloud.sleuth.instrument.web.client)
execute:92, InterceptingClientHttpRequest$InterceptingRequestExecution (org.springframework.http.client)
//restTemplate 拦截器
executeInternal:76, InterceptingClientHttpRequest (org.springframework.http.client)
executeInternal:48, AbstractBufferingClientHttpRequest (org.springframework.http.client)
execute:53, AbstractClientHttpRequest (org.springframework.http.client)
doExecute:723, RestTemplate (org.springframework.web.client)
execute:690, RestTemplate (org.springframework.web.client)
//认证远程调用
retrieveToken:137, OAuth2AccessTokenSupport (org.springframework.security.oauth2.client.token)
obtainAccessToken:44, ClientCredentialsAccessTokenProvider (org.springframework.security.oauth2.client.token.grant.client)
obtainNewAccessTokenInternal:148, AccessTokenProviderChain (org.springframework.security.oauth2.client.token)
obtainAccessToken:121, AccessTokenProviderChain (org.springframework.security.oauth2.client.token)
acquireAccessToken:171, OAuth2FeignRequestInterceptor (org.springframework.cloud.security.oauth2.client.feign)
getToken:127, OAuth2FeignRequestInterceptor (org.springframework.cloud.security.oauth2.client.feign)
extract:112, OAuth2FeignRequestInterceptor (org.springframework.cloud.security.oauth2.client.feign)
//fegin拦截器
apply:100, OAuth2FeignRequestInterceptor (org.springframework.cloud.security.oauth2.client.feign)
targetRequest:158, SynchronousMethodHandler (feign)
//
executeAndDecode:88, SynchronousMethodHandler (feign)
invoke:76, SynchronousMethodHandler (feign)
//HystrixInvocationHandler
run:108, HystrixInvocationHandler$1 (feign.hystrix)
call:302, HystrixCommand$2 (com.netflix.hystrix)
call:298, HystrixCommand$2 (com.netflix.hystrix)
call:46, OnSubscribeDefer (rx.internal.operators)
call:35, OnSubscribeDefer (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:51, OnSubscribeDefer (rx.internal.operators)
call:35, OnSubscribeDefer (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:100, OperatorSubscribeOn$SubscribeOnSubscriber (rx.internal.operators)
call:56, HystrixContexSchedulerAction$1 (com.netflix.hystrix.strategy.concurrency)
call:47, HystrixContexSchedulerAction$1 (com.netflix.hystrix.strategy.concurrency)
call:63, TraceCallable (org.springframework.cloud.sleuth.instrument.async)
call:69, HystrixContexSchedulerAction (com.netflix.hystrix.strategy.concurrency)
run:55, ScheduledAction (rx.internal.schedulers)
call:511, Executors$RunnableAdapter (java.util.concurrent)
run$$$capture:266, FutureTask (java.util.concurrent)
run:-1, FutureTask (java.util.concurrent)
 - Async stack trace
<init>:151, FutureTask (java.util.concurrent)
newTaskFor:87, AbstractExecutorService (java.util.concurrent)
submit:111, AbstractExecutorService (java.util.concurrent)
schedule:172, HystrixContextScheduler$ThreadPoolWorker (com.netflix.hystrix.strategy.concurrency)
schedule:106, HystrixContextScheduler$HystrixContextSchedulerWorker (com.netflix.hystrix.strategy.concurrency)
call:50, OperatorSubscribeOn (rx.internal.operators)
call:30, OperatorSubscribeOn (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:51, OnSubscribeDefer (rx.internal.operators)
call:35, OnSubscribeDefer (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:48, OnSubscribeMap (rx.internal.operators)
call:33, OnSubscribeMap (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:51, OnSubscribeDefer (rx.internal.operators)
call:35, OnSubscribeDefer (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
subscribe:10423, Observable (rx)
subscribe:10390, Observable (rx)
toFuture:51, BlockingOperatorToFuture (rx.internal.operators)
toFuture:410, BlockingObservable (rx.observables)
queue:378, HystrixCommand (com.netflix.hystrix)
//hystrix
execute:344, HystrixCommand (com.netflix.hystrix)
invoke:159, HystrixInvocationHandler (feign.hystrix)
//openfein 调用
createUser:-1, $Proxy196 (com.sun.proxy)
create:52, AccountServiceImpl (com.piggymetrics.account.service)
createNewAccount:37, AccountController (com.piggymetrics.account.controller)
invoke:-1, AccountController$$FastClassBySpringCGLIB$$794775f6 (com.piggymetrics.account.controller)
invoke:204, MethodProxy (org.springframework.cglib.proxy)
intercept:684, CglibAopProxy$DynamicAdvisedInterceptor (org.springframework.aop.framework)
createNewAccount:-1, AccountController$$EnhancerBySpringCGLIB$$3856455c (com.piggymetrics.account.controller)
invoke0:-2, NativeMethodAccessorImpl (sun.reflect)
invoke:62, NativeMethodAccessorImpl (sun.reflect)
invoke:43, DelegatingMethodAccessorImpl (sun.reflect)
invoke:498, Method (java.lang.reflect)
doInvoke:209, InvocableHandlerMethod (org.springframework.web.method.support)
invokeForRequest:136, InvocableHandlerMethod (org.springframework.web.method.support)
invokeAndHandle:102, ServletInvocableHandlerMethod (org.springframework.web.servlet.mvc.method.annotation)
invokeHandlerMethod:877, RequestMappingHandlerAdapter (org.springframework.web.servlet.mvc.method.annotation)
handleInternal:783, RequestMappingHandlerAdapter (org.springframework.web.servlet.mvc.method.annotation)
handle:87, AbstractHandlerMethodAdapter (org.springframework.web.servlet.mvc.method)
doDispatch:991, DispatcherServlet (org.springframework.web.servlet)
doService:925, DispatcherServlet (org.springframework.web.servlet)
processRequest:974, FrameworkServlet (org.springframework.web.servlet)
doPost:877, FrameworkServlet (org.springframework.web.servlet)
service:661, HttpServlet (javax.servlet.http)
service:851, FrameworkServlet (org.springframework.web.servlet)
service:742, HttpServlet (javax.servlet.http)
internalDoFilter:231, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:52, WsFilter (org.apache.tomcat.websocket.server)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:60, OAuth2ClientContextFilter (org.springframework.security.oauth2.client.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
filterAndRecordMetrics:158, WebMvcMetricsFilter (org.springframework.boot.actuate.metrics.web.servlet)
filterAndRecordMetrics:126, WebMvcMetricsFilter (org.springframework.boot.actuate.metrics.web.servlet)
doFilterInternal:111, WebMvcMetricsFilter (org.springframework.boot.actuate.metrics.web.servlet)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:90, HttpTraceFilter (org.springframework.boot.actuate.web.trace.servlet)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:320, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
invoke:127, FilterSecurityInterceptor (org.springframework.security.web.access.intercept)
doFilter:91, FilterSecurityInterceptor (org.springframework.security.web.access.intercept)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:119, ExceptionTranslationFilter (org.springframework.security.web.access)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:137, SessionManagementFilter (org.springframework.security.web.session)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:111, AnonymousAuthenticationFilter (org.springframework.security.web.authentication)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:170, SecurityContextHolderAwareRequestFilter (org.springframework.security.web.servletapi)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:63, RequestCacheAwareFilter (org.springframework.security.web.savedrequest)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:176, OAuth2AuthenticationProcessingFilter (org.springframework.security.oauth2.provider.authentication)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:116, LogoutFilter (org.springframework.security.web.authentication.logout)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilterInternal:66, HeaderWriterFilter (org.springframework.security.web.header)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:105, SecurityContextPersistenceFilter (org.springframework.security.web.context)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilterInternal:56, WebAsyncManagerIntegrationFilter (org.springframework.security.web.context.request.async)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilterInternal:215, FilterChainProxy (org.springframework.security.web)
doFilter:178, FilterChainProxy (org.springframework.security.web)
invokeDelegate:357, DelegatingFilterProxy (org.springframework.web.filter)
doFilter:270, DelegatingFilterProxy (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:99, RequestContextFilter (org.springframework.web.filter)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:109, HttpPutFormContentFilter (org.springframework.web.filter)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:93, HiddenHttpMethodFilter (org.springframework.web.filter)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:48, ExceptionLoggingFilter (org.springframework.cloud.sleuth.instrument.web)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:86, TracingFilter (brave.servlet)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:200, CharacterEncodingFilter (org.springframework.web.filter)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
invoke:198, StandardWrapperValve (org.apache.catalina.core)
invoke:96, StandardContextValve (org.apache.catalina.core)
invoke:496, AuthenticatorBase (org.apache.catalina.authenticator)
invoke:140, StandardHostValve (org.apache.catalina.core)
invoke:81, ErrorReportValve (org.apache.catalina.valves)
invoke:87, StandardEngineValve (org.apache.catalina.core)
service:342, CoyoteAdapter (org.apache.catalina.connector)
service:803, Http11Processor (org.apache.coyote.http11)
process:66, AbstractProcessorLight (org.apache.coyote)
process:790, AbstractProtocol$ConnectionHandler (org.apache.coyote)
doRun:1468, NioEndpoint$SocketProcessor (org.apache.tomcat.util.net)
run:49, SocketProcessorBase (org.apache.tomcat.util.net)
runWorker:1149, ThreadPoolExecutor (java.util.concurrent)
run:624, ThreadPoolExecutor$Worker (java.util.concurrent)
run:61, TaskThread$WrappingRunnable (org.apache.tomcat.util.threads)
run:748, Thread (java.lang)
~~~

###### 执行远程调用（response = client.execute(request, options) 分支）

~~~java
getLoadBalancer:38, AbstractLoadBalancerRule (com.netflix.loadbalancer)
choose:44, PredicateBasedRule (com.netflix.loadbalancer)
//getPredicate()
chooseServer:736, BaseLoadBalancer (com.netflix.loadbalancer)
chooseServer:113, ZoneAwareLoadBalancer (com.netflix.loadbalancer)
getServerFromLoadBalancer:481, LoadBalancerContext (com.netflix.loadbalancer)
call:184, LoadBalancerCommand$1 (com.netflix.loadbalancer.reactive)
call:180, LoadBalancerCommand$1 (com.netflix.loadbalancer.reactive)
unsafeSubscribe:10327, Observable (rx)
call:94, OnSubscribeConcatMap (rx.internal.operators)
call:42, OnSubscribeConcatMap (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:127, OperatorRetryWithPredicate$SourceSubscriber$1 (rx.internal.operators)
enqueue:73, TrampolineScheduler$InnerCurrentThreadScheduler (rx.internal.schedulers)
schedule:52, TrampolineScheduler$InnerCurrentThreadScheduler (rx.internal.schedulers)
onNext:79, OperatorRetryWithPredicate$SourceSubscriber (rx.internal.operators)
onNext:45, OperatorRetryWithPredicate$SourceSubscriber (rx.internal.operators)
request:276, ScalarSynchronousObservable$WeakSingleProducer (rx.internal.util)
setProducer:209, Subscriber (rx)
call:138, ScalarSynchronousObservable$JustOnSubscribe (rx.internal.util)
call:129, ScalarSynchronousObservable$JustOnSubscribe (rx.internal.util)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
subscribe:10423, Observable (rx)
subscribe:10390, Observable (rx)
blockForSingle:443, BlockingObservable (rx.observables)
single:340, BlockingObservable (rx.observables)
executeWithLoadBalancer:112, AbstractLoadBalancerAwareClient (com.netflix.client)
execute:63, LoadBalancerFeignClient (org.springframework.cloud.openfeign.ribbon)
execute:67, TraceLoadBalancerFeignClient (org.springframework.cloud.sleuth.instrument.web.client.feign)
//
executeAndDecode:97, SynchronousMethodHandler (feign)
invoke:76, SynchronousMethodHandler (feign)
run:108, HystrixInvocationHandler$1 (feign.hystrix)
call:302, HystrixCommand$2 (com.netflix.hystrix)
call:298, HystrixCommand$2 (com.netflix.hystrix)
call:46, OnSubscribeDefer (rx.internal.operators)
call:35, OnSubscribeDefer (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:51, OnSubscribeDefer (rx.internal.operators)
call:35, OnSubscribeDefer (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:100, OperatorSubscribeOn$SubscribeOnSubscriber (rx.internal.operators)
call:56, HystrixContexSchedulerAction$1 (com.netflix.hystrix.strategy.concurrency)
call:47, HystrixContexSchedulerAction$1 (com.netflix.hystrix.strategy.concurrency)
call:63, TraceCallable (org.springframework.cloud.sleuth.instrument.async)
call:69, HystrixContexSchedulerAction (com.netflix.hystrix.strategy.concurrency)
run:55, ScheduledAction (rx.internal.schedulers)
call:511, Executors$RunnableAdapter (java.util.concurrent)
run$$$capture:266, FutureTask (java.util.concurrent)
run:-1, FutureTask (java.util.concurrent)
 - Async stack trace
<init>:151, FutureTask (java.util.concurrent)
newTaskFor:87, AbstractExecutorService (java.util.concurrent)
submit:111, AbstractExecutorService (java.util.concurrent)
schedule:172, HystrixContextScheduler$ThreadPoolWorker (com.netflix.hystrix.strategy.concurrency)
schedule:106, HystrixContextScheduler$HystrixContextSchedulerWorker (com.netflix.hystrix.strategy.concurrency)
call:50, OperatorSubscribeOn (rx.internal.operators)
call:30, OperatorSubscribeOn (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:51, OnSubscribeDefer (rx.internal.operators)
call:35, OnSubscribeDefer (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:48, OnSubscribeMap (rx.internal.operators)
call:33, OnSubscribeMap (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:51, OnSubscribeDefer (rx.internal.operators)
call:35, OnSubscribeDefer (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
subscribe:10423, Observable (rx)
subscribe:10390, Observable (rx)
toFuture:51, BlockingOperatorToFuture (rx.internal.operators)
toFuture:410, BlockingObservable (rx.observables)
queue:378, HystrixCommand (com.netflix.hystrix)
execute:344, HystrixCommand (com.netflix.hystrix)
invoke:159, HystrixInvocationHandler (feign.hystrix)
createUser:-1, $Proxy196 (com.sun.proxy)
create:52, AccountServiceImpl (com.piggymetrics.account.service)
createNewAccount:37, AccountController (com.piggymetrics.account.controller)
invoke:-1, AccountController$$FastClassBySpringCGLIB$$794775f6 (com.piggymetrics.account.controller)
invoke:204, MethodProxy (org.springframework.cglib.proxy)
intercept:684, CglibAopProxy$DynamicAdvisedInterceptor (org.springframework.aop.framework)
createNewAccount:-1, AccountController$$EnhancerBySpringCGLIB$$29151b32 (com.piggymetrics.account.controller)
invoke0:-2, NativeMethodAccessorImpl (sun.reflect)
invoke:62, NativeMethodAccessorImpl (sun.reflect)
invoke:43, DelegatingMethodAccessorImpl (sun.reflect)
invoke:498, Method (java.lang.reflect)
doInvoke:209, InvocableHandlerMethod (org.springframework.web.method.support)
invokeForRequest:136, InvocableHandlerMethod (org.springframework.web.method.support)
invokeAndHandle:102, ServletInvocableHandlerMethod (org.springframework.web.servlet.mvc.method.annotation)
invokeHandlerMethod:877, RequestMappingHandlerAdapter (org.springframework.web.servlet.mvc.method.annotation)
handleInternal:783, RequestMappingHandlerAdapter (org.springframework.web.servlet.mvc.method.annotation)
handle:87, AbstractHandlerMethodAdapter (org.springframework.web.servlet.mvc.method)
doDispatch:991, DispatcherServlet (org.springframework.web.servlet)
doService:925, DispatcherServlet (org.springframework.web.servlet)
processRequest:974, FrameworkServlet (org.springframework.web.servlet)
doPost:877, FrameworkServlet (org.springframework.web.servlet)
service:661, HttpServlet (javax.servlet.http)
service:851, FrameworkServlet (org.springframework.web.servlet)
service:742, HttpServlet (javax.servlet.http)
internalDoFilter:231, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:52, WsFilter (org.apache.tomcat.websocket.server)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:60, OAuth2ClientContextFilter (org.springframework.security.oauth2.client.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
filterAndRecordMetrics:158, WebMvcMetricsFilter (org.springframework.boot.actuate.metrics.web.servlet)
filterAndRecordMetrics:126, WebMvcMetricsFilter (org.springframework.boot.actuate.metrics.web.servlet)
doFilterInternal:111, WebMvcMetricsFilter (org.springframework.boot.actuate.metrics.web.servlet)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:90, HttpTraceFilter (org.springframework.boot.actuate.web.trace.servlet)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:320, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
invoke:127, FilterSecurityInterceptor (org.springframework.security.web.access.intercept)
doFilter:91, FilterSecurityInterceptor (org.springframework.security.web.access.intercept)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:119, ExceptionTranslationFilter (org.springframework.security.web.access)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:137, SessionManagementFilter (org.springframework.security.web.session)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:111, AnonymousAuthenticationFilter (org.springframework.security.web.authentication)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:170, SecurityContextHolderAwareRequestFilter (org.springframework.security.web.servletapi)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:63, RequestCacheAwareFilter (org.springframework.security.web.savedrequest)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:176, OAuth2AuthenticationProcessingFilter (org.springframework.security.oauth2.provider.authentication)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:116, LogoutFilter (org.springframework.security.web.authentication.logout)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilterInternal:66, HeaderWriterFilter (org.springframework.security.web.header)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:105, SecurityContextPersistenceFilter (org.springframework.security.web.context)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilterInternal:56, WebAsyncManagerIntegrationFilter (org.springframework.security.web.context.request.async)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilterInternal:215, FilterChainProxy (org.springframework.security.web)
doFilter:178, FilterChainProxy (org.springframework.security.web)
invokeDelegate:357, DelegatingFilterProxy (org.springframework.web.filter)
doFilter:270, DelegatingFilterProxy (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:99, RequestContextFilter (org.springframework.web.filter)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:109, HttpPutFormContentFilter (org.springframework.web.filter)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:93, HiddenHttpMethodFilter (org.springframework.web.filter)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:48, ExceptionLoggingFilter (org.springframework.cloud.sleuth.instrument.web)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:86, TracingFilter (brave.servlet)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:200, CharacterEncodingFilter (org.springframework.web.filter)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
invoke:198, StandardWrapperValve (org.apache.catalina.core)
invoke:96, StandardContextValve (org.apache.catalina.core)
invoke:496, AuthenticatorBase (org.apache.catalina.authenticator)
invoke:140, StandardHostValve (org.apache.catalina.core)
invoke:81, ErrorReportValve (org.apache.catalina.valves)
invoke:87, StandardEngineValve (org.apache.catalina.core)
service:342, CoyoteAdapter (org.apache.catalina.connector)
service:803, Http11Processor (org.apache.coyote.http11)
process:66, AbstractProcessorLight (org.apache.coyote)
process:790, AbstractProtocol$ConnectionHandler (org.apache.coyote)
doRun:1468, NioEndpoint$SocketProcessor (org.apache.tomcat.util.net)
run:49, SocketProcessorBase (org.apache.tomcat.util.net)
runWorker:1149, ThreadPoolExecutor (java.util.concurrent)
run:624, ThreadPoolExecutor$Worker (java.util.concurrent)
run:61, TaskThread$WrappingRunnable (org.apache.tomcat.util.threads)
run:748, Thread (java.lang)
~~~

###### executeAndDecode （feign 构建request 并执行）（feign的method handler）

~~~java
//...feign.SynchronousMethodHandler...
  Object executeAndDecode(RequestTemplate template) throws Throwable {
    // feign的url
    Request request = targetRequest(template);

    if (logLevel != Logger.Level.NONE) {
      logger.logRequest(metadata.configKey(), logLevel, request);
    }

    Response response;
    long start = System.nanoTime();
    try {
      //
      response = client.execute(request, options);
      // ensure the request is set. TODO: remove in Feign 10
      response.toBuilder().request(request).build();
    } catch (IOException e) {
      if (logLevel != Logger.Level.NONE) {
        logger.logIOException(metadata.configKey(), logLevel, e, elapsedTime(start));
      }
      throw errorExecuting(request, e);
    }
    long elapsedTime = TimeUnit.NANOSECONDS.toMillis(System.nanoTime() - start);

    boolean shouldClose = true;
    try {
      if (logLevel != Logger.Level.NONE) {
        response =
            logger.logAndRebufferResponse(metadata.configKey(), logLevel, response, elapsedTime);
        // ensure the request is set. TODO: remove in Feign 10
        response.toBuilder().request(request).build();
      }
      if (Response.class == metadata.returnType()) {
        if (response.body() == null) {
          return response;
        }
        if (response.body().length() == null ||
                response.body().length() > MAX_RESPONSE_BUFFER_SIZE) {
          shouldClose = false;
          return response;
        }
        // Ensure the response body is disconnected
        byte[] bodyData = Util.toByteArray(response.body().asInputStream());
        return response.toBuilder().body(bodyData).build();
      }
      if (response.status() >= 200 && response.status() < 300) {
        if (void.class == metadata.returnType()) {
          return null;
        } else {
          return decode(response);
        }
      } else if (decode404 && response.status() == 404 && void.class != metadata.returnType()) {
        return decode(response);
      } else {
        throw errorDecoder.decode(metadata.configKey(), response);
      }
    } catch (IOException e) {
      if (logLevel != Logger.Level.NONE) {
        logger.logIOException(metadata.configKey(), logLevel, e, elapsedTime);
      }
      throw errorReading(request, response, e);
    } finally {
      if (shouldClose) {
        ensureClosed(response.body());
      }
    }
  }


//构造request 
Request targetRequest(RequestTemplate template) {
    for (RequestInterceptor interceptor : requestInterceptors) {
        //这里就是拦截器里的东西  会调用oauth2的template  这两步都有loadbalance
        interceptor.apply(template);
    }
    //最终调用feign的url  这两步都有loadbalance
    return target.apply(new RequestTemplate(template));
}
~~~

###### RetryLoadBalancerInterceptor (RestTemplate 的 intercepter)

~~~java
//...org.springframework.cloud.client.loadbalancer.RetryLoadBalancerInterceptor...
public ClientHttpResponse intercept(final HttpRequest request, final byte[] body,
                                    final ClientHttpRequestExecution execution) throws IOException {
    final URI originalUri = request.getURI();
    final String serviceName = originalUri.getHost();
    Assert.state(serviceName != null, "Request URI does not contain a valid hostname: " + originalUri);
    //这里会初始化loadbanlence
    final LoadBalancedRetryPolicy retryPolicy = lbRetryFactory.createRetryPolicy(serviceName,
                                                                                 loadBalancer);
    RetryTemplate template = createRetryTemplate(serviceName, request, retryPolicy);
    //执行
    return template.execute(context -> {
        ServiceInstance serviceInstance = null;
        if (context instanceof LoadBalancedRetryContext) {
            LoadBalancedRetryContext lbContext = (LoadBalancedRetryContext) context;
            serviceInstance = lbContext.getServiceInstance();
        }
        if (serviceInstance == null) {
            serviceInstance = loadBalancer.choose(serviceName);
        }
        ClientHttpResponse response = RetryLoadBalancerInterceptor.this.loadBalancer.execute(
            serviceName, serviceInstance,
            requestFactory.createRequest(request, body, execution));
        int statusCode = response.getRawStatusCode();
        if (retryPolicy != null && retryPolicy.retryableStatusCode(statusCode)) {
            byte[] bodyCopy = StreamUtils.copyToByteArray(response.getBody());
            response.close();
            throw new ClientHttpResponseStatusCodeException(serviceName, response, bodyCopy);
        }
        return response;
    }, new LoadBalancedRecoveryCallback<ClientHttpResponse, ClientHttpResponse>() {
        //This is a special case, where both parameters to LoadBalancedRecoveryCallback are
        //the same.  In most cases they would be different.
        @Override
        protected ClientHttpResponse createResponse(ClientHttpResponse response, URI uri) {
            return response;
        }
    });
}
~~~



###### 准备完成后执行feign调用

~~~java
apply:81, ZoneAvoidancePredicate (com.netflix.loadbalancer)
apply:40, ZoneAvoidancePredicate (com.netflix.loadbalancer)
apply:343, Predicates$AndPredicate (com.google.common.base)
apply:214, AbstractServerPredicate$3 (com.netflix.loadbalancer)
apply:210, AbstractServerPredicate$3 (com.netflix.loadbalancer)
apply:52, CompositePredicate (com.netflix.loadbalancer)
apply:40, CompositePredicate (com.netflix.loadbalancer)
apply:55, AbstractServerPredicate$1 (com.netflix.loadbalancer)
apply:52, AbstractServerPredicate$1 (com.netflix.loadbalancer)
computeNext:647, Iterators$7 (com.google.common.collect)
tryToComputeNext:143, AbstractIterator (com.google.common.collect)
hasNext:138, AbstractIterator (com.google.common.collect)
copyOf:268, ImmutableList (com.google.common.collect)
copyOf:226, ImmutableList (com.google.common.collect)
getEligibleServers:129, AbstractServerPredicate (com.netflix.loadbalancer)
getEligibleServers:105, CompositePredicate (com.netflix.loadbalancer)
chooseRoundRobinAfterFiltering:199, AbstractServerPredicate (com.netflix.loadbalancer)
choose:45, PredicateBasedRule (com.netflix.loadbalancer)
//getLoadBalancer()
chooseServer:736, BaseLoadBalancer (com.netflix.loadbalancer)
chooseServer:113, ZoneAwareLoadBalancer (com.netflix.loadbalancer)
getServerFromLoadBalancer:481, LoadBalancerContext (com.netflix.loadbalancer)
call:184, LoadBalancerCommand$1 (com.netflix.loadbalancer.reactive)
call:180, LoadBalancerCommand$1 (com.netflix.loadbalancer.reactive)
unsafeSubscribe:10327, Observable (rx)
call:94, OnSubscribeConcatMap (rx.internal.operators)
call:42, OnSubscribeConcatMap (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:127, OperatorRetryWithPredicate$SourceSubscriber$1 (rx.internal.operators)
enqueue:73, TrampolineScheduler$InnerCurrentThreadScheduler (rx.internal.schedulers)
schedule:52, TrampolineScheduler$InnerCurrentThreadScheduler (rx.internal.schedulers)
onNext:79, OperatorRetryWithPredicate$SourceSubscriber (rx.internal.operators)
onNext:45, OperatorRetryWithPredicate$SourceSubscriber (rx.internal.operators)
request:276, ScalarSynchronousObservable$WeakSingleProducer (rx.internal.util)
setProducer:209, Subscriber (rx)
call:138, ScalarSynchronousObservable$JustOnSubscribe (rx.internal.util)
call:129, ScalarSynchronousObservable$JustOnSubscribe (rx.internal.util)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
subscribe:10423, Observable (rx)
subscribe:10390, Observable (rx)
blockForSingle:443, BlockingObservable (rx.observables)
single:340, BlockingObservable (rx.observables)
executeWithLoadBalancer:112, AbstractLoadBalancerAwareClient (com.netflix.client)
execute:63, LoadBalancerFeignClient (org.springframework.cloud.openfeign.ribbon)
execute:67, TraceLoadBalancerFeignClient (org.springframework.cloud.sleuth.instrument.web.client.feign)
//准备完成后执行feign调用
executeAndDecode:97, SynchronousMethodHandler (feign)
invoke:76, SynchronousMethodHandler (feign)
run:108, HystrixInvocationHandler$1 (feign.hystrix)
call:302, HystrixCommand$2 (com.netflix.hystrix)
call:298, HystrixCommand$2 (com.netflix.hystrix)
call:46, OnSubscribeDefer (rx.internal.operators)
call:35, OnSubscribeDefer (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:51, OnSubscribeDefer (rx.internal.operators)
call:35, OnSubscribeDefer (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:100, OperatorSubscribeOn$SubscribeOnSubscriber (rx.internal.operators)
call:56, HystrixContexSchedulerAction$1 (com.netflix.hystrix.strategy.concurrency)
call:47, HystrixContexSchedulerAction$1 (com.netflix.hystrix.strategy.concurrency)
call:63, TraceCallable (org.springframework.cloud.sleuth.instrument.async)
call:69, HystrixContexSchedulerAction (com.netflix.hystrix.strategy.concurrency)
run:55, ScheduledAction (rx.internal.schedulers)
call:511, Executors$RunnableAdapter (java.util.concurrent)
run$$$capture:266, FutureTask (java.util.concurrent)
run:-1, FutureTask (java.util.concurrent)
 - Async stack trace
<init>:151, FutureTask (java.util.concurrent)
newTaskFor:87, AbstractExecutorService (java.util.concurrent)
submit:111, AbstractExecutorService (java.util.concurrent)
schedule:172, HystrixContextScheduler$ThreadPoolWorker (com.netflix.hystrix.strategy.concurrency)
schedule:106, HystrixContextScheduler$HystrixContextSchedulerWorker (com.netflix.hystrix.strategy.concurrency)
call:50, OperatorSubscribeOn (rx.internal.operators)
call:30, OperatorSubscribeOn (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:51, OnSubscribeDefer (rx.internal.operators)
call:35, OnSubscribeDefer (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:48, OnSubscribeMap (rx.internal.operators)
call:33, OnSubscribeMap (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:51, OnSubscribeDefer (rx.internal.operators)
call:35, OnSubscribeDefer (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
subscribe:10423, Observable (rx)
subscribe:10390, Observable (rx)
toFuture:51, BlockingOperatorToFuture (rx.internal.operators)
toFuture:410, BlockingObservable (rx.observables)
queue:378, HystrixCommand (com.netflix.hystrix)
execute:344, HystrixCommand (com.netflix.hystrix)
invoke:159, HystrixInvocationHandler (feign.hystrix)
createUser:-1, $Proxy196 (com.sun.proxy)
create:52, AccountServiceImpl (com.piggymetrics.account.service)
createNewAccount:37, AccountController (com.piggymetrics.account.controller)
invoke:-1, AccountController$$FastClassBySpringCGLIB$$794775f6 (com.piggymetrics.account.controller)
invoke:204, MethodProxy (org.springframework.cglib.proxy)
intercept:684, CglibAopProxy$DynamicAdvisedInterceptor (org.springframework.aop.framework)
createNewAccount:-1, AccountController$$EnhancerBySpringCGLIB$$29151b32 (com.piggymetrics.account.controller)
invoke0:-2, NativeMethodAccessorImpl (sun.reflect)
invoke:62, NativeMethodAccessorImpl (sun.reflect)
invoke:43, DelegatingMethodAccessorImpl (sun.reflect)
invoke:498, Method (java.lang.reflect)
doInvoke:209, InvocableHandlerMethod (org.springframework.web.method.support)
invokeForRequest:136, InvocableHandlerMethod (org.springframework.web.method.support)
invokeAndHandle:102, ServletInvocableHandlerMethod (org.springframework.web.servlet.mvc.method.annotation)
invokeHandlerMethod:877, RequestMappingHandlerAdapter (org.springframework.web.servlet.mvc.method.annotation)
handleInternal:783, RequestMappingHandlerAdapter (org.springframework.web.servlet.mvc.method.annotation)
handle:87, AbstractHandlerMethodAdapter (org.springframework.web.servlet.mvc.method)
doDispatch:991, DispatcherServlet (org.springframework.web.servlet)
doService:925, DispatcherServlet (org.springframework.web.servlet)
processRequest:974, FrameworkServlet (org.springframework.web.servlet)
doPost:877, FrameworkServlet (org.springframework.web.servlet)
service:661, HttpServlet (javax.servlet.http)
service:851, FrameworkServlet (org.springframework.web.servlet)
service:742, HttpServlet (javax.servlet.http)
internalDoFilter:231, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:52, WsFilter (org.apache.tomcat.websocket.server)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:60, OAuth2ClientContextFilter (org.springframework.security.oauth2.client.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
filterAndRecordMetrics:158, WebMvcMetricsFilter (org.springframework.boot.actuate.metrics.web.servlet)
filterAndRecordMetrics:126, WebMvcMetricsFilter (org.springframework.boot.actuate.metrics.web.servlet)
doFilterInternal:111, WebMvcMetricsFilter (org.springframework.boot.actuate.metrics.web.servlet)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:90, HttpTraceFilter (org.springframework.boot.actuate.web.trace.servlet)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:320, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
invoke:127, FilterSecurityInterceptor (org.springframework.security.web.access.intercept)
doFilter:91, FilterSecurityInterceptor (org.springframework.security.web.access.intercept)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:119, ExceptionTranslationFilter (org.springframework.security.web.access)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:137, SessionManagementFilter (org.springframework.security.web.session)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:111, AnonymousAuthenticationFilter (org.springframework.security.web.authentication)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:170, SecurityContextHolderAwareRequestFilter (org.springframework.security.web.servletapi)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:63, RequestCacheAwareFilter (org.springframework.security.web.savedrequest)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:176, OAuth2AuthenticationProcessingFilter (org.springframework.security.oauth2.provider.authentication)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:116, LogoutFilter (org.springframework.security.web.authentication.logout)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilterInternal:66, HeaderWriterFilter (org.springframework.security.web.header)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:105, SecurityContextPersistenceFilter (org.springframework.security.web.context)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilterInternal:56, WebAsyncManagerIntegrationFilter (org.springframework.security.web.context.request.async)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilterInternal:215, FilterChainProxy (org.springframework.security.web)
doFilter:178, FilterChainProxy (org.springframework.security.web)
invokeDelegate:357, DelegatingFilterProxy (org.springframework.web.filter)
doFilter:270, DelegatingFilterProxy (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:99, RequestContextFilter (org.springframework.web.filter)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:109, HttpPutFormContentFilter (org.springframework.web.filter)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:93, HiddenHttpMethodFilter (org.springframework.web.filter)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:48, ExceptionLoggingFilter (org.springframework.cloud.sleuth.instrument.web)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:86, TracingFilter (brave.servlet)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:200, CharacterEncodingFilter (org.springframework.web.filter)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
invoke:198, StandardWrapperValve (org.apache.catalina.core)
invoke:96, StandardContextValve (org.apache.catalina.core)
invoke:496, AuthenticatorBase (org.apache.catalina.authenticator)
invoke:140, StandardHostValve (org.apache.catalina.core)
invoke:81, ErrorReportValve (org.apache.catalina.valves)
invoke:87, StandardEngineValve (org.apache.catalina.core)
service:342, CoyoteAdapter (org.apache.catalina.connector)
service:803, Http11Processor (org.apache.coyote.http11)
process:66, AbstractProcessorLight (org.apache.coyote)
process:790, AbstractProtocol$ConnectionHandler (org.apache.coyote)
doRun:1468, NioEndpoint$SocketProcessor (org.apache.tomcat.util.net)
run:49, SocketProcessorBase (org.apache.tomcat.util.net)
runWorker:1149, ThreadPoolExecutor (java.util.concurrent)
run:624, ThreadPoolExecutor$Worker (java.util.concurrent)
run:61, TaskThread$WrappingRunnable (org.apache.tomcat.util.threads)
run:748, Thread (java.lang)
~~~

###### 准备fegin的request（根据loadbalance 寻找认证服务器）

~~~java
getInstancesByVipAddress:708, DiscoveryClient (com.netflix.discovery)
invoke0:-1, NativeMethodAccessorImpl (sun.reflect)
invoke:62, NativeMethodAccessorImpl (sun.reflect)
invoke:43, DelegatingMethodAccessorImpl (sun.reflect)
invoke:498, Method (java.lang.reflect)
invokeMethod:223, ReflectionUtils (org.springframework.util)
invoke:494, GenericScope$LockedScopedProxyFactoryBean (org.springframework.cloud.context.scope)
proceed:185, ReflectiveMethodInvocation (org.springframework.aop.framework)
invoke:212, JdkDynamicAopProxy (org.springframework.aop.framework)
getInstancesByVipAddress:-1, $Proxy175 (com.sun.proxy)
obtainServersViaDiscovery:167, DiscoveryEnabledNIWSServerList (com.netflix.niws.loadbalancer)
getUpdatedListOfServers:152, DiscoveryEnabledNIWSServerList (com.netflix.niws.loadbalancer)
getUpdatedListOfServers:57, DomainExtractingServerList (org.springframework.cloud.netflix.ribbon.eureka)
updateListOfServers:240, DynamicServerListLoadBalancer (com.netflix.loadbalancer)
//直接更新
restOfInit:144, DynamicServerListLoadBalancer (com.netflix.loadbalancer)
<init>:95, DynamicServerListLoadBalancer (com.netflix.loadbalancer)
<init>:82, ZoneAwareLoadBalancer (com.netflix.loadbalancer)
ribbonLoadBalancer:137, RibbonClientConfiguration (org.springframework.cloud.netflix.ribbon)
CGLIB$ribbonLoadBalancer$10:-1, RibbonClientConfiguration$$EnhancerBySpringCGLIB$$a72eb488 (org.springframework.cloud.netflix.ribbon)
invoke:-1, RibbonClientConfiguration$$EnhancerBySpringCGLIB$$a72eb488$$FastClassBySpringCGLIB$$208a3f9b (org.springframework.cloud.netflix.ribbon)
invokeSuper:228, MethodProxy (org.springframework.cglib.proxy)
intercept:361, ConfigurationClassEnhancer$BeanMethodInterceptor (org.springframework.context.annotation)
ribbonLoadBalancer:-1, RibbonClientConfiguration$$EnhancerBySpringCGLIB$$a72eb488 (org.springframework.cloud.netflix.ribbon)
invoke0:-1, NativeMethodAccessorImpl (sun.reflect)
invoke:62, NativeMethodAccessorImpl (sun.reflect)
invoke:43, DelegatingMethodAccessorImpl (sun.reflect)
invoke:498, Method (java.lang.reflect)
instantiate:154, SimpleInstantiationStrategy (org.springframework.beans.factory.support)
instantiateUsingFactoryMethod:582, ConstructorResolver (org.springframework.beans.factory.support)
instantiateUsingFactoryMethod:1256, AbstractAutowireCapableBeanFactory (org.springframework.beans.factory.support)
createBeanInstance:1105, AbstractAutowireCapableBeanFactory (org.springframework.beans.factory.support)
doCreateBean:543, AbstractAutowireCapableBeanFactory (org.springframework.beans.factory.support)
createBean:503, AbstractAutowireCapableBeanFactory (org.springframework.beans.factory.support)
lambda$doGetBean$0:317, AbstractBeanFactory (org.springframework.beans.factory.support)
getObject:-1, 1624351535 (org.springframework.beans.factory.support.AbstractBeanFactory$$Lambda$167)
getSingleton:222, DefaultSingletonBeanRegistry (org.springframework.beans.factory.support)
doGetBean:315, AbstractBeanFactory (org.springframework.beans.factory.support)
getBean:199, AbstractBeanFactory (org.springframework.beans.factory.support)
resolveCandidate:251, DependencyDescriptor (org.springframework.beans.factory.config)
doResolveDependency:1138, DefaultListableBeanFactory (org.springframework.beans.factory.support)
resolveDependency:1065, DefaultListableBeanFactory (org.springframework.beans.factory.support)
resolveAutowiredArgument:818, ConstructorResolver (org.springframework.beans.factory.support)
createArgumentArray:724, ConstructorResolver (org.springframework.beans.factory.support)
instantiateUsingFactoryMethod:474, ConstructorResolver (org.springframework.beans.factory.support)
instantiateUsingFactoryMethod:1256, AbstractAutowireCapableBeanFactory (org.springframework.beans.factory.support)
createBeanInstance:1105, AbstractAutowireCapableBeanFactory (org.springframework.beans.factory.support)
doCreateBean:543, AbstractAutowireCapableBeanFactory (org.springframework.beans.factory.support)
createBean:503, AbstractAutowireCapableBeanFactory (org.springframework.beans.factory.support)
lambda$doGetBean$0:317, AbstractBeanFactory (org.springframework.beans.factory.support)
getObject:-1, 1624351535 (org.springframework.beans.factory.support.AbstractBeanFactory$$Lambda$167)
getSingleton:222, DefaultSingletonBeanRegistry (org.springframework.beans.factory.support)
doGetBean:315, AbstractBeanFactory (org.springframework.beans.factory.support)
getBean:199, AbstractBeanFactory (org.springframework.beans.factory.support)
preInstantiateSingletons:760, DefaultListableBeanFactory (org.springframework.beans.factory.support)
finishBeanFactoryInitialization:869, AbstractApplicationContext (org.springframework.context.support)
refresh:550, AbstractApplicationContext (org.springframework.context.support)
createContext:117, NamedContextFactory (org.springframework.cloud.context.named)
getContext:85, NamedContextFactory (org.springframework.cloud.context.named)
getContext:118, SpringClientFactory (org.springframework.cloud.netflix.ribbon)
getInstance:126, NamedContextFactory (org.springframework.cloud.context.named)
getInstance:108, SpringClientFactory (org.springframework.cloud.netflix.ribbon)
getLoadBalancerContext:73, SpringClientFactory (org.springframework.cloud.netflix.ribbon)
createRetryPolicy:38, RibbonLoadBalancedRetryFactory (org.springframework.cloud.netflix.ribbon)
intercept:64, RetryLoadBalancerInterceptor (org.springframework.cloud.client.loadbalancer)
execute:92, InterceptingClientHttpRequest$InterceptingRequestExecution (org.springframework.http.client)
intercept:53, TracingClientHttpRequestInterceptor (brave.spring.web)
intercept:292, LazyTracingClientHttpRequestInterceptor (org.springframework.cloud.sleuth.instrument.web.client)
execute:92, InterceptingClientHttpRequest$InterceptingRequestExecution (org.springframework.http.client)
executeInternal:76, InterceptingClientHttpRequest (org.springframework.http.client)
executeInternal:48, AbstractBufferingClientHttpRequest (org.springframework.http.client)
execute:53, AbstractClientHttpRequest (org.springframework.http.client)
doExecute:723, RestTemplate (org.springframework.web.client)
execute:690, RestTemplate (org.springframework.web.client)
retrieveToken:137, OAuth2AccessTokenSupport (org.springframework.security.oauth2.client.token)
obtainAccessToken:44, ClientCredentialsAccessTokenProvider (org.springframework.security.oauth2.client.token.grant.client)
obtainNewAccessTokenInternal:148, AccessTokenProviderChain (org.springframework.security.oauth2.client.token)
obtainAccessToken:121, AccessTokenProviderChain (org.springframework.security.oauth2.client.token)
acquireAccessToken:171, OAuth2FeignRequestInterceptor (org.springframework.cloud.security.oauth2.client.feign)
getToken:127, OAuth2FeignRequestInterceptor (org.springframework.cloud.security.oauth2.client.feign)
extract:112, OAuth2FeignRequestInterceptor (org.springframework.cloud.security.oauth2.client.feign)
apply:100, OAuth2FeignRequestInterceptor (org.springframework.cloud.security.oauth2.client.feign)
targetRequest:158, SynchronousMethodHandler (feign)
executeAndDecode:88, SynchronousMethodHandler (feign)
invoke:76, SynchronousMethodHandler (feign)
run:108, HystrixInvocationHandler$1 (feign.hystrix)
call:302, HystrixCommand$2 (com.netflix.hystrix)
call:298, HystrixCommand$2 (com.netflix.hystrix)
call:46, OnSubscribeDefer (rx.internal.operators)
call:35, OnSubscribeDefer (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:51, OnSubscribeDefer (rx.internal.operators)
call:35, OnSubscribeDefer (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:100, OperatorSubscribeOn$SubscribeOnSubscriber (rx.internal.operators)
call:56, HystrixContexSchedulerAction$1 (com.netflix.hystrix.strategy.concurrency)
call:47, HystrixContexSchedulerAction$1 (com.netflix.hystrix.strategy.concurrency)
call:63, TraceCallable (org.springframework.cloud.sleuth.instrument.async)
call:69, HystrixContexSchedulerAction (com.netflix.hystrix.strategy.concurrency)
run:55, ScheduledAction (rx.internal.schedulers)
call:511, Executors$RunnableAdapter (java.util.concurrent)
run$$$capture:266, FutureTask (java.util.concurrent)
run:-1, FutureTask (java.util.concurrent)
 - Async stack trace
<init>:151, FutureTask (java.util.concurrent)
newTaskFor:87, AbstractExecutorService (java.util.concurrent)
submit:111, AbstractExecutorService (java.util.concurrent)
schedule:172, HystrixContextScheduler$ThreadPoolWorker (com.netflix.hystrix.strategy.concurrency)
schedule:106, HystrixContextScheduler$HystrixContextSchedulerWorker (com.netflix.hystrix.strategy.concurrency)
call:50, OperatorSubscribeOn (rx.internal.operators)
call:30, OperatorSubscribeOn (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:51, OnSubscribeDefer (rx.internal.operators)
call:35, OnSubscribeDefer (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:48, OnSubscribeMap (rx.internal.operators)
call:33, OnSubscribeMap (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:51, OnSubscribeDefer (rx.internal.operators)
call:35, OnSubscribeDefer (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
subscribe:10423, Observable (rx)
subscribe:10390, Observable (rx)
toFuture:51, BlockingOperatorToFuture (rx.internal.operators)
toFuture:410, BlockingObservable (rx.observables)
queue:378, HystrixCommand (com.netflix.hystrix)
execute:344, HystrixCommand (com.netflix.hystrix)
invoke:159, HystrixInvocationHandler (feign.hystrix)
createUser:-1, $Proxy196 (com.sun.proxy)
create:52, AccountServiceImpl (com.piggymetrics.account.service)
createNewAccount:37, AccountController (com.piggymetrics.account.controller)
invoke:-1, AccountController$$FastClassBySpringCGLIB$$794775f6 (com.piggymetrics.account.controller)
invoke:204, MethodProxy (org.springframework.cglib.proxy)
intercept:684, CglibAopProxy$DynamicAdvisedInterceptor (org.springframework.aop.framework)
createNewAccount:-1, AccountController$$EnhancerBySpringCGLIB$$bbf79668 (com.piggymetrics.account.controller)
invoke0:-2, NativeMethodAccessorImpl (sun.reflect)
invoke:62, NativeMethodAccessorImpl (sun.reflect)
invoke:43, DelegatingMethodAccessorImpl (sun.reflect)
invoke:498, Method (java.lang.reflect)
doInvoke:209, InvocableHandlerMethod (org.springframework.web.method.support)
invokeForRequest:136, InvocableHandlerMethod (org.springframework.web.method.support)
invokeAndHandle:102, ServletInvocableHandlerMethod (org.springframework.web.servlet.mvc.method.annotation)
invokeHandlerMethod:877, RequestMappingHandlerAdapter (org.springframework.web.servlet.mvc.method.annotation)
handleInternal:783, RequestMappingHandlerAdapter (org.springframework.web.servlet.mvc.method.annotation)
handle:87, AbstractHandlerMethodAdapter (org.springframework.web.servlet.mvc.method)
doDispatch:991, DispatcherServlet (org.springframework.web.servlet)
doService:925, DispatcherServlet (org.springframework.web.servlet)
processRequest:974, FrameworkServlet (org.springframework.web.servlet)
doPost:877, FrameworkServlet (org.springframework.web.servlet)
service:661, HttpServlet (javax.servlet.http)
service:851, FrameworkServlet (org.springframework.web.servlet)
service:742, HttpServlet (javax.servlet.http)
internalDoFilter:231, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:52, WsFilter (org.apache.tomcat.websocket.server)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:60, OAuth2ClientContextFilter (org.springframework.security.oauth2.client.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
filterAndRecordMetrics:158, WebMvcMetricsFilter (org.springframework.boot.actuate.metrics.web.servlet)
filterAndRecordMetrics:126, WebMvcMetricsFilter (org.springframework.boot.actuate.metrics.web.servlet)
doFilterInternal:111, WebMvcMetricsFilter (org.springframework.boot.actuate.metrics.web.servlet)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:90, HttpTraceFilter (org.springframework.boot.actuate.web.trace.servlet)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:320, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
invoke:127, FilterSecurityInterceptor (org.springframework.security.web.access.intercept)
doFilter:91, FilterSecurityInterceptor (org.springframework.security.web.access.intercept)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:119, ExceptionTranslationFilter (org.springframework.security.web.access)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:137, SessionManagementFilter (org.springframework.security.web.session)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:111, AnonymousAuthenticationFilter (org.springframework.security.web.authentication)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:170, SecurityContextHolderAwareRequestFilter (org.springframework.security.web.servletapi)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:63, RequestCacheAwareFilter (org.springframework.security.web.savedrequest)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:176, OAuth2AuthenticationProcessingFilter (org.springframework.security.oauth2.provider.authentication)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:116, LogoutFilter (org.springframework.security.web.authentication.logout)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilterInternal:66, HeaderWriterFilter (org.springframework.security.web.header)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:105, SecurityContextPersistenceFilter (org.springframework.security.web.context)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilterInternal:56, WebAsyncManagerIntegrationFilter (org.springframework.security.web.context.request.async)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilterInternal:215, FilterChainProxy (org.springframework.security.web)
doFilter:178, FilterChainProxy (org.springframework.security.web)
invokeDelegate:357, DelegatingFilterProxy (org.springframework.web.filter)
doFilter:270, DelegatingFilterProxy (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:99, RequestContextFilter (org.springframework.web.filter)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:109, HttpPutFormContentFilter (org.springframework.web.filter)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:93, HiddenHttpMethodFilter (org.springframework.web.filter)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:48, ExceptionLoggingFilter (org.springframework.cloud.sleuth.instrument.web)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:86, TracingFilter (brave.servlet)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:200, CharacterEncodingFilter (org.springframework.web.filter)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
invoke:198, StandardWrapperValve (org.apache.catalina.core)
invoke:96, StandardContextValve (org.apache.catalina.core)
invoke:496, AuthenticatorBase (org.apache.catalina.authenticator)
invoke:140, StandardHostValve (org.apache.catalina.core)
invoke:81, ErrorReportValve (org.apache.catalina.valves)
invoke:87, StandardEngineValve (org.apache.catalina.core)
service:342, CoyoteAdapter (org.apache.catalina.connector)
service:803, Http11Processor (org.apache.coyote.http11)
process:66, AbstractProcessorLight (org.apache.coyote)
process:790, AbstractProtocol$ConnectionHandler (org.apache.coyote)
doRun:1468, NioEndpoint$SocketProcessor (org.apache.tomcat.util.net)
run:49, SocketProcessorBase (org.apache.tomcat.util.net)
runWorker:1149, ThreadPoolExecutor (java.util.concurrent)
run:624, ThreadPoolExecutor$Worker (java.util.concurrent)
run:61, TaskThread$WrappingRunnable (org.apache.tomcat.util.threads)
run:748, Thread (java.lang)
~~~

###### 准备fegin的request（根据loadbalance 寻找认证服务器 异步任务）

~~~java
//根据服务名字获取服务
getInstancesByVipAddress:708, DiscoveryClient (com.netflix.discovery)
invoke0:-1, NativeMethodAccessorImpl (sun.reflect)
invoke:62, NativeMethodAccessorImpl (sun.reflect)
invoke:43, DelegatingMethodAccessorImpl (sun.reflect)
invoke:498, Method (java.lang.reflect)
invokeMethod:223, ReflectionUtils (org.springframework.util)
invoke:494, GenericScope$LockedScopedProxyFactoryBean (org.springframework.cloud.context.scope)
proceed:185, ReflectiveMethodInvocation (org.springframework.aop.framework)
invoke:212, JdkDynamicAopProxy (org.springframework.aop.framework)
getInstancesByVipAddress:-1, $Proxy175 (com.sun.proxy)
obtainServersViaDiscovery:167, DiscoveryEnabledNIWSServerList (com.netflix.niws.loadbalancer)
getUpdatedListOfServers:152, DiscoveryEnabledNIWSServerList (com.netflix.niws.loadbalancer)
getUpdatedListOfServers:57, DomainExtractingServerList (org.springframework.cloud.netflix.ribbon.eureka)
//这里拿到服务列表 先按照zoneId 筛选一遍
updateListOfServers:240, DynamicServerListLoadBalancer (com.netflix.loadbalancer)
doUpdate:62, DynamicServerListLoadBalancer$1 (com.netflix.loadbalancer)
run:116, PollingServerListUpdater$1 (com.netflix.loadbalancer)
call:511, Executors$RunnableAdapter (java.util.concurrent)
runAndReset$$$capture:308, FutureTask (java.util.concurrent)
runAndReset:-1, FutureTask (java.util.concurrent)
 - Async stack trace
<init>:151, FutureTask (java.util.concurrent)
<init>:219, ScheduledThreadPoolExecutor$ScheduledFutureTask (java.util.concurrent)
scheduleWithFixedDelay:594, ScheduledThreadPoolExecutor (java.util.concurrent)
start:124, PollingServerListUpdater (com.netflix.loadbalancer)
enableAndInitLearnNewServersFeature:223, DynamicServerListLoadBalancer (com.netflix.loadbalancer)
//restOfInit中定义了一个定时任务异步 拉取服务列表
restOfInit:142, DynamicServerListLoadBalancer (com.netflix.loadbalancer)
<init>:95, DynamicServerListLoadBalancer (com.netflix.loadbalancer)
<init>:82, ZoneAwareLoadBalancer (com.netflix.loadbalancer)
ribbonLoadBalancer:137, RibbonClientConfiguration (org.springframework.cloud.netflix.ribbon)
CGLIB$ribbonLoadBalancer$3:-1, RibbonClientConfiguration$$EnhancerBySpringCGLIB$$b31ad5f5 (org.springframework.cloud.netflix.ribbon)
invoke:-1, RibbonClientConfiguration$$EnhancerBySpringCGLIB$$b31ad5f5$$FastClassBySpringCGLIB$$b2e63ae1 (org.springframework.cloud.netflix.ribbon)
invokeSuper:228, MethodProxy (org.springframework.cglib.proxy)
intercept:361, ConfigurationClassEnhancer$BeanMethodInterceptor (org.springframework.context.annotation)
ribbonLoadBalancer:-1, RibbonClientConfiguration$$EnhancerBySpringCGLIB$$b31ad5f5 (org.springframework.cloud.netflix.ribbon)
invoke0:-2, NativeMethodAccessorImpl (sun.reflect)
invoke:62, NativeMethodAccessorImpl (sun.reflect)
invoke:43, DelegatingMethodAccessorImpl (sun.reflect)
invoke:498, Method (java.lang.reflect)
instantiate:154, SimpleInstantiationStrategy (org.springframework.beans.factory.support)
instantiateUsingFactoryMethod:582, ConstructorResolver (org.springframework.beans.factory.support)
instantiateUsingFactoryMethod:1256, AbstractAutowireCapableBeanFactory (org.springframework.beans.factory.support)
createBeanInstance:1105, AbstractAutowireCapableBeanFactory (org.springframework.beans.factory.support)
doCreateBean:543, AbstractAutowireCapableBeanFactory (org.springframework.beans.factory.support)
createBean:503, AbstractAutowireCapableBeanFactory (org.springframework.beans.factory.support)
lambda$doGetBean$0:317, AbstractBeanFactory (org.springframework.beans.factory.support)
getSingleton:222, DefaultSingletonBeanRegistry (org.springframework.beans.factory.support)
doGetBean:315, AbstractBeanFactory (org.springframework.beans.factory.support)
getBean:199, AbstractBeanFactory (org.springframework.beans.factory.support)
resolveCandidate:251, DependencyDescriptor (org.springframework.beans.factory.config)
doResolveDependency:1138, DefaultListableBeanFactory (org.springframework.beans.factory.support)
resolveDependency:1065, DefaultListableBeanFactory (org.springframework.beans.factory.support)
resolveAutowiredArgument:818, ConstructorResolver (org.springframework.beans.factory.support)
createArgumentArray:724, ConstructorResolver (org.springframework.beans.factory.support)
instantiateUsingFactoryMethod:474, ConstructorResolver (org.springframework.beans.factory.support)
instantiateUsingFactoryMethod:1256, AbstractAutowireCapableBeanFactory (org.springframework.beans.factory.support)
createBeanInstance:1105, AbstractAutowireCapableBeanFactory (org.springframework.beans.factory.support)
doCreateBean:543, AbstractAutowireCapableBeanFactory (org.springframework.beans.factory.support)
createBean:503, AbstractAutowireCapableBeanFactory (org.springframework.beans.factory.support)
lambda$doGetBean$0:317, AbstractBeanFactory (org.springframework.beans.factory.support)
getSingleton:222, DefaultSingletonBeanRegistry (org.springframework.beans.factory.support)
doGetBean:315, AbstractBeanFactory (org.springframework.beans.factory.support)
getBean:199, AbstractBeanFactory (org.springframework.beans.factory.support)
preInstantiateSingletons:760, DefaultListableBeanFactory (org.springframework.beans.factory.support)
finishBeanFactoryInitialization:869, AbstractApplicationContext (org.springframework.context.support)
refresh:550, AbstractApplicationContext (org.springframework.context.support)
createContext:117, NamedContextFactory (org.springframework.cloud.context.named)
getContext:85, NamedContextFactory (org.springframework.cloud.context.named)
getContext:118, SpringClientFactory (org.springframework.cloud.netflix.ribbon)
getInstance:126, NamedContextFactory (org.springframework.cloud.context.named)
getInstance:108, SpringClientFactory (org.springframework.cloud.netflix.ribbon)
getLoadBalancerContext:73, SpringClientFactory (org.springframework.cloud.netflix.ribbon)
createRetryPolicy:38, RibbonLoadBalancedRetryFactory (org.springframework.cloud.netflix.ribbon)
intercept:64, RetryLoadBalancerInterceptor (org.springframework.cloud.client.loadbalancer)
execute:92, InterceptingClientHttpRequest$InterceptingRequestExecution (org.springframework.http.client)
intercept:53, TracingClientHttpRequestInterceptor (brave.spring.web)
intercept:292, LazyTracingClientHttpRequestInterceptor (org.springframework.cloud.sleuth.instrument.web.client)
execute:92, InterceptingClientHttpRequest$InterceptingRequestExecution (org.springframework.http.client)
executeInternal:76, InterceptingClientHttpRequest (org.springframework.http.client)
executeInternal:48, AbstractBufferingClientHttpRequest (org.springframework.http.client)
execute:53, AbstractClientHttpRequest (org.springframework.http.client)
doExecute:723, RestTemplate (org.springframework.web.client)
execute:690, RestTemplate (org.springframework.web.client)
retrieveToken:137, OAuth2AccessTokenSupport (org.springframework.security.oauth2.client.token)
obtainAccessToken:44, ClientCredentialsAccessTokenProvider (org.springframework.security.oauth2.client.token.grant.client)
obtainNewAccessTokenInternal:148, AccessTokenProviderChain (org.springframework.security.oauth2.client.token)
obtainAccessToken:121, AccessTokenProviderChain (org.springframework.security.oauth2.client.token)
acquireAccessToken:171, OAuth2FeignRequestInterceptor (org.springframework.cloud.security.oauth2.client.feign)
getToken:127, OAuth2FeignRequestInterceptor (org.springframework.cloud.security.oauth2.client.feign)
extract:112, OAuth2FeignRequestInterceptor (org.springframework.cloud.security.oauth2.client.feign)
apply:100, OAuth2FeignRequestInterceptor (org.springframework.cloud.security.oauth2.client.feign)
targetRequest:158, SynchronousMethodHandler (feign)
//准备fegin的request
executeAndDecode:88, SynchronousMethodHandler (feign)
invoke:76, SynchronousMethodHandler (feign)
run:108, HystrixInvocationHandler$1 (feign.hystrix)
call:302, HystrixCommand$2 (com.netflix.hystrix)
call:298, HystrixCommand$2 (com.netflix.hystrix)
call:46, OnSubscribeDefer (rx.internal.operators)
call:35, OnSubscribeDefer (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:51, OnSubscribeDefer (rx.internal.operators)
call:35, OnSubscribeDefer (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:100, OperatorSubscribeOn$SubscribeOnSubscriber (rx.internal.operators)
call:56, HystrixContexSchedulerAction$1 (com.netflix.hystrix.strategy.concurrency)
call:47, HystrixContexSchedulerAction$1 (com.netflix.hystrix.strategy.concurrency)
call:63, TraceCallable (org.springframework.cloud.sleuth.instrument.async)
call:69, HystrixContexSchedulerAction (com.netflix.hystrix.strategy.concurrency)
run:55, ScheduledAction (rx.internal.schedulers)
call:511, Executors$RunnableAdapter (java.util.concurrent)
run$$$capture:266, FutureTask (java.util.concurrent)
run:-1, FutureTask (java.util.concurrent)
 - Async stack trace
<init>:151, FutureTask (java.util.concurrent)
newTaskFor:87, AbstractExecutorService (java.util.concurrent)
submit:111, AbstractExecutorService (java.util.concurrent)
schedule:172, HystrixContextScheduler$ThreadPoolWorker (com.netflix.hystrix.strategy.concurrency)
schedule:106, HystrixContextScheduler$HystrixContextSchedulerWorker (com.netflix.hystrix.strategy.concurrency)
call:50, OperatorSubscribeOn (rx.internal.operators)
call:30, OperatorSubscribeOn (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:51, OnSubscribeDefer (rx.internal.operators)
call:35, OnSubscribeDefer (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:48, OnSubscribeMap (rx.internal.operators)
call:33, OnSubscribeMap (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:51, OnSubscribeDefer (rx.internal.operators)
call:35, OnSubscribeDefer (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
subscribe:10423, Observable (rx)
subscribe:10390, Observable (rx)
toFuture:51, BlockingOperatorToFuture (rx.internal.operators)
toFuture:410, BlockingObservable (rx.observables)
queue:378, HystrixCommand (com.netflix.hystrix)
execute:344, HystrixCommand (com.netflix.hystrix)
invoke:159, HystrixInvocationHandler (feign.hystrix)
createUser:-1, $Proxy196 (com.sun.proxy)
create:52, AccountServiceImpl (com.piggymetrics.account.service)
createNewAccount:37, AccountController (com.piggymetrics.account.controller)
invoke:-1, AccountController$$FastClassBySpringCGLIB$$794775f6 (com.piggymetrics.account.controller)
invoke:204, MethodProxy (org.springframework.cglib.proxy)
intercept:684, CglibAopProxy$DynamicAdvisedInterceptor (org.springframework.aop.framework)
createNewAccount:-1, AccountController$$EnhancerBySpringCGLIB$$e7d1edc2 (com.piggymetrics.account.controller)
invoke0:-2, NativeMethodAccessorImpl (sun.reflect)
invoke:62, NativeMethodAccessorImpl (sun.reflect)
invoke:43, DelegatingMethodAccessorImpl (sun.reflect)
invoke:498, Method (java.lang.reflect)
doInvoke:209, InvocableHandlerMethod (org.springframework.web.method.support)
invokeForRequest:136, InvocableHandlerMethod (org.springframework.web.method.support)
invokeAndHandle:102, ServletInvocableHandlerMethod (org.springframework.web.servlet.mvc.method.annotation)
invokeHandlerMethod:877, RequestMappingHandlerAdapter (org.springframework.web.servlet.mvc.method.annotation)
handleInternal:783, RequestMappingHandlerAdapter (org.springframework.web.servlet.mvc.method.annotation)
handle:87, AbstractHandlerMethodAdapter (org.springframework.web.servlet.mvc.method)
doDispatch:991, DispatcherServlet (org.springframework.web.servlet)
doService:925, DispatcherServlet (org.springframework.web.servlet)
processRequest:974, FrameworkServlet (org.springframework.web.servlet)
doPost:877, FrameworkServlet (org.springframework.web.servlet)
service:661, HttpServlet (javax.servlet.http)
service:851, FrameworkServlet (org.springframework.web.servlet)
service:742, HttpServlet (javax.servlet.http)
internalDoFilter:231, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:52, WsFilter (org.apache.tomcat.websocket.server)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:60, OAuth2ClientContextFilter (org.springframework.security.oauth2.client.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
filterAndRecordMetrics:158, WebMvcMetricsFilter (org.springframework.boot.actuate.metrics.web.servlet)
filterAndRecordMetrics:126, WebMvcMetricsFilter (org.springframework.boot.actuate.metrics.web.servlet)
doFilterInternal:111, WebMvcMetricsFilter (org.springframework.boot.actuate.metrics.web.servlet)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:90, HttpTraceFilter (org.springframework.boot.actuate.web.trace.servlet)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:320, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
invoke:127, FilterSecurityInterceptor (org.springframework.security.web.access.intercept)
doFilter:91, FilterSecurityInterceptor (org.springframework.security.web.access.intercept)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:119, ExceptionTranslationFilter (org.springframework.security.web.access)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:137, SessionManagementFilter (org.springframework.security.web.session)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:111, AnonymousAuthenticationFilter (org.springframework.security.web.authentication)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:170, SecurityContextHolderAwareRequestFilter (org.springframework.security.web.servletapi)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:63, RequestCacheAwareFilter (org.springframework.security.web.savedrequest)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:176, OAuth2AuthenticationProcessingFilter (org.springframework.security.oauth2.provider.authentication)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:116, LogoutFilter (org.springframework.security.web.authentication.logout)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilterInternal:66, HeaderWriterFilter (org.springframework.security.web.header)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:105, SecurityContextPersistenceFilter (org.springframework.security.web.context)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilterInternal:56, WebAsyncManagerIntegrationFilter (org.springframework.security.web.context.request.async)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilterInternal:215, FilterChainProxy (org.springframework.security.web)
doFilter:178, FilterChainProxy (org.springframework.security.web)
invokeDelegate:357, DelegatingFilterProxy (org.springframework.web.filter)
doFilter:270, DelegatingFilterProxy (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:99, RequestContextFilter (org.springframework.web.filter)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:109, HttpPutFormContentFilter (org.springframework.web.filter)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:93, HiddenHttpMethodFilter (org.springframework.web.filter)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:48, ExceptionLoggingFilter (org.springframework.cloud.sleuth.instrument.web)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:86, TracingFilter (brave.servlet)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:200, CharacterEncodingFilter (org.springframework.web.filter)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
invoke:198, StandardWrapperValve (org.apache.catalina.core)
invoke:96, StandardContextValve (org.apache.catalina.core)
invoke:496, AuthenticatorBase (org.apache.catalina.authenticator)
invoke:140, StandardHostValve (org.apache.catalina.core)
invoke:81, ErrorReportValve (org.apache.catalina.valves)
invoke:87, StandardEngineValve (org.apache.catalina.core)
service:342, CoyoteAdapter (org.apache.catalina.connector)
service:803, Http11Processor (org.apache.coyote.http11)
process:66, AbstractProcessorLight (org.apache.coyote)
process:790, AbstractProtocol$ConnectionHandler (org.apache.coyote)
doRun:1468, NioEndpoint$SocketProcessor (org.apache.tomcat.util.net)
run:49, SocketProcessorBase (org.apache.tomcat.util.net)
runWorker:1149, ThreadPoolExecutor (java.util.concurrent)
run:624, ThreadPoolExecutor$Worker (java.util.concurrent)
run:61, TaskThread$WrappingRunnable (org.apache.tomcat.util.threads)
run:748, Thread (java.lang)
~~~

###### 找到认证服务器do获取token

~~~java
lambda$intercept$0:68, RetryLoadBalancerInterceptor (org.springframework.cloud.client.loadbalancer)
doWithRetry:-1, 664941108 (org.springframework.cloud.client.loadbalancer.RetryLoadBalancerInterceptor$$Lambda$1036)
doExecute:287, RetryTemplate (org.springframework.retry.support)
execute:180, RetryTemplate (org.springframework.retry.support)
intercept:67, RetryLoadBalancerInterceptor (org.springframework.cloud.client.loadbalancer)
execute:92, InterceptingClientHttpRequest$InterceptingRequestExecution (org.springframework.http.client)
intercept:53, TracingClientHttpRequestInterceptor (brave.spring.web)
intercept:292, LazyTracingClientHttpRequestInterceptor (org.springframework.cloud.sleuth.instrument.web.client)
execute:92, InterceptingClientHttpRequest$InterceptingRequestExecution (org.springframework.http.client)
executeInternal:76, InterceptingClientHttpRequest (org.springframework.http.client)
executeInternal:48, AbstractBufferingClientHttpRequest (org.springframework.http.client)
execute:53, AbstractClientHttpRequest (org.springframework.http.client)
doExecute:723, RestTemplate (org.springframework.web.client)
execute:690, RestTemplate (org.springframework.web.client)
retrieveToken:137, OAuth2AccessTokenSupport (org.springframework.security.oauth2.client.token)
obtainAccessToken:44, ClientCredentialsAccessTokenProvider (org.springframework.security.oauth2.client.token.grant.client)
obtainNewAccessTokenInternal:148, AccessTokenProviderChain (org.springframework.security.oauth2.client.token)
obtainAccessToken:121, AccessTokenProviderChain (org.springframework.security.oauth2.client.token)
acquireAccessToken:171, OAuth2FeignRequestInterceptor (org.springframework.cloud.security.oauth2.client.feign)
getToken:127, OAuth2FeignRequestInterceptor (org.springframework.cloud.security.oauth2.client.feign)
extract:112, OAuth2FeignRequestInterceptor (org.springframework.cloud.security.oauth2.client.feign)
apply:100, OAuth2FeignRequestInterceptor (org.springframework.cloud.security.oauth2.client.feign)
targetRequest:158, SynchronousMethodHandler (feign)
executeAndDecode:88, SynchronousMethodHandler (feign)
invoke:76, SynchronousMethodHandler (feign)
run:108, HystrixInvocationHandler$1 (feign.hystrix)
call:302, HystrixCommand$2 (com.netflix.hystrix)
call:298, HystrixCommand$2 (com.netflix.hystrix)
call:46, OnSubscribeDefer (rx.internal.operators)
call:35, OnSubscribeDefer (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:51, OnSubscribeDefer (rx.internal.operators)
call:35, OnSubscribeDefer (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:100, OperatorSubscribeOn$SubscribeOnSubscriber (rx.internal.operators)
call:56, HystrixContexSchedulerAction$1 (com.netflix.hystrix.strategy.concurrency)
call:47, HystrixContexSchedulerAction$1 (com.netflix.hystrix.strategy.concurrency)
call:63, TraceCallable (org.springframework.cloud.sleuth.instrument.async)
call:69, HystrixContexSchedulerAction (com.netflix.hystrix.strategy.concurrency)
run:55, ScheduledAction (rx.internal.schedulers)
call:511, Executors$RunnableAdapter (java.util.concurrent)
run$$$capture:266, FutureTask (java.util.concurrent)
run:-1, FutureTask (java.util.concurrent)
 - Async stack trace
<init>:151, FutureTask (java.util.concurrent)
newTaskFor:87, AbstractExecutorService (java.util.concurrent)
submit:111, AbstractExecutorService (java.util.concurrent)
schedule:172, HystrixContextScheduler$ThreadPoolWorker (com.netflix.hystrix.strategy.concurrency)
schedule:106, HystrixContextScheduler$HystrixContextSchedulerWorker (com.netflix.hystrix.strategy.concurrency)
call:50, OperatorSubscribeOn (rx.internal.operators)
call:30, OperatorSubscribeOn (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:51, OnSubscribeDefer (rx.internal.operators)
call:35, OnSubscribeDefer (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:48, OnSubscribeMap (rx.internal.operators)
call:33, OnSubscribeMap (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:41, OnSubscribeDoOnEach (rx.internal.operators)
call:30, OnSubscribeDoOnEach (rx.internal.operators)
unsafeSubscribe:10327, Observable (rx)
call:51, OnSubscribeDefer (rx.internal.operators)
call:35, OnSubscribeDefer (rx.internal.operators)
call:48, OnSubscribeLift (rx.internal.operators)
call:30, OnSubscribeLift (rx.internal.operators)
subscribe:10423, Observable (rx)
subscribe:10390, Observable (rx)
toFuture:51, BlockingOperatorToFuture (rx.internal.operators)
toFuture:410, BlockingObservable (rx.observables)
queue:378, HystrixCommand (com.netflix.hystrix)
execute:344, HystrixCommand (com.netflix.hystrix)
invoke:159, HystrixInvocationHandler (feign.hystrix)
createUser:-1, $Proxy196 (com.sun.proxy)
create:52, AccountServiceImpl (com.piggymetrics.account.service)
createNewAccount:37, AccountController (com.piggymetrics.account.controller)
invoke:-1, AccountController$$FastClassBySpringCGLIB$$794775f6 (com.piggymetrics.account.controller)
invoke:204, MethodProxy (org.springframework.cglib.proxy)
intercept:684, CglibAopProxy$DynamicAdvisedInterceptor (org.springframework.aop.framework)
createNewAccount:-1, AccountController$$EnhancerBySpringCGLIB$$b9417d75 (com.piggymetrics.account.controller)
invoke0:-2, NativeMethodAccessorImpl (sun.reflect)
invoke:62, NativeMethodAccessorImpl (sun.reflect)
invoke:43, DelegatingMethodAccessorImpl (sun.reflect)
invoke:498, Method (java.lang.reflect)
doInvoke:209, InvocableHandlerMethod (org.springframework.web.method.support)
invokeForRequest:136, InvocableHandlerMethod (org.springframework.web.method.support)
invokeAndHandle:102, ServletInvocableHandlerMethod (org.springframework.web.servlet.mvc.method.annotation)
invokeHandlerMethod:877, RequestMappingHandlerAdapter (org.springframework.web.servlet.mvc.method.annotation)
handleInternal:783, RequestMappingHandlerAdapter (org.springframework.web.servlet.mvc.method.annotation)
handle:87, AbstractHandlerMethodAdapter (org.springframework.web.servlet.mvc.method)
doDispatch:991, DispatcherServlet (org.springframework.web.servlet)
doService:925, DispatcherServlet (org.springframework.web.servlet)
processRequest:974, FrameworkServlet (org.springframework.web.servlet)
doPost:877, FrameworkServlet (org.springframework.web.servlet)
service:661, HttpServlet (javax.servlet.http)
service:851, FrameworkServlet (org.springframework.web.servlet)
service:742, HttpServlet (javax.servlet.http)
internalDoFilter:231, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:52, WsFilter (org.apache.tomcat.websocket.server)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:60, OAuth2ClientContextFilter (org.springframework.security.oauth2.client.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
filterAndRecordMetrics:158, WebMvcMetricsFilter (org.springframework.boot.actuate.metrics.web.servlet)
filterAndRecordMetrics:126, WebMvcMetricsFilter (org.springframework.boot.actuate.metrics.web.servlet)
doFilterInternal:111, WebMvcMetricsFilter (org.springframework.boot.actuate.metrics.web.servlet)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:90, HttpTraceFilter (org.springframework.boot.actuate.web.trace.servlet)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:320, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
invoke:127, FilterSecurityInterceptor (org.springframework.security.web.access.intercept)
doFilter:91, FilterSecurityInterceptor (org.springframework.security.web.access.intercept)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:119, ExceptionTranslationFilter (org.springframework.security.web.access)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:137, SessionManagementFilter (org.springframework.security.web.session)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:111, AnonymousAuthenticationFilter (org.springframework.security.web.authentication)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:170, SecurityContextHolderAwareRequestFilter (org.springframework.security.web.servletapi)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:63, RequestCacheAwareFilter (org.springframework.security.web.savedrequest)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:176, OAuth2AuthenticationProcessingFilter (org.springframework.security.oauth2.provider.authentication)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:116, LogoutFilter (org.springframework.security.web.authentication.logout)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilterInternal:66, HeaderWriterFilter (org.springframework.security.web.header)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilter:105, SecurityContextPersistenceFilter (org.springframework.security.web.context)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilterInternal:56, WebAsyncManagerIntegrationFilter (org.springframework.security.web.context.request.async)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
doFilter:334, FilterChainProxy$VirtualFilterChain (org.springframework.security.web)
doFilterInternal:215, FilterChainProxy (org.springframework.security.web)
doFilter:178, FilterChainProxy (org.springframework.security.web)
invokeDelegate:357, DelegatingFilterProxy (org.springframework.web.filter)
doFilter:270, DelegatingFilterProxy (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:99, RequestContextFilter (org.springframework.web.filter)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:109, HttpPutFormContentFilter (org.springframework.web.filter)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:93, HiddenHttpMethodFilter (org.springframework.web.filter)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:48, ExceptionLoggingFilter (org.springframework.cloud.sleuth.instrument.web)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilter:86, TracingFilter (brave.servlet)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
doFilterInternal:200, CharacterEncodingFilter (org.springframework.web.filter)
doFilter:107, OncePerRequestFilter (org.springframework.web.filter)
internalDoFilter:193, ApplicationFilterChain (org.apache.catalina.core)
doFilter:166, ApplicationFilterChain (org.apache.catalina.core)
invoke:198, StandardWrapperValve (org.apache.catalina.core)
invoke:96, StandardContextValve (org.apache.catalina.core)
invoke:496, AuthenticatorBase (org.apache.catalina.authenticator)
invoke:140, StandardHostValve (org.apache.catalina.core)
invoke:81, ErrorReportValve (org.apache.catalina.valves)
invoke:87, StandardEngineValve (org.apache.catalina.core)
service:342, CoyoteAdapter (org.apache.catalina.connector)
service:803, Http11Processor (org.apache.coyote.http11)
process:66, AbstractProcessorLight (org.apache.coyote)
process:790, AbstractProtocol$ConnectionHandler (org.apache.coyote)
doRun:1468, NioEndpoint$SocketProcessor (org.apache.tomcat.util.net)
run:49, SocketProcessorBase (org.apache.tomcat.util.net)
runWorker:1149, ThreadPoolExecutor (java.util.concurrent)
run:624, ThreadPoolExecutor$Worker (java.util.concurrent)
run:61, TaskThread$WrappingRunnable (org.apache.tomcat.util.threads)
run:748, Thread (java.lang)
~~~





